{% extends 'base.html' %}
{% block title %}Dashboard Â· CISSP Test Simulator{% endblock %}
{% block content %}
  <div class="row g-4">
    <div class="col-md-6">
      <div class="card h-100">
        <div class="card-body">
          <h5 class="card-title">Get Started</h5>
          <p class="card-text">Import your CISSP practice questions, launch a new test, or focus on the questions you previously missed.</p>
          <div class="d-grid gap-2">
            <a class="btn btn-primary" href="{{ url_for('import_view') }}">Import Questions</a>
            <a class="btn btn-success" href="{{ url_for('new_test') }}" {% if question_count == 0 %}disabled{% endif %}>Start New Test</a>
            <a class="btn btn-outline-warning" href="{{ url_for('review') }}" {% if wrong_count == 0 %}disabled{% endif %}>Review Mistakes</a>
          </div>
        </div>
      </div>
    </div>

    <div class="col-md-6">
      <div class="card h-100">
        <div class="card-body">
          <h5 class="card-title">Question Bank Overview</h5>
          <p class="card-text">You currently have <strong>{{ question_count }}</strong> questions available across {{ domains|length }} domain(s).</p>
          <ul class="list-group list-group-flush">
            {% for domain in domains %}
              <li class="list-group-item">{{ domain }}</li>
            {% else %}
              <li class="list-group-item text-muted">No domains available yet.</li>
            {% endfor %}
          </ul>
        </div>
      </div>
    </div>
  </div>

  <div class="row g-4 mt-1">
    <div class="col-12">
      <div class="card">
        <div class="card-body">
          <h5 class="card-title">Recent Mistakes</h5>
          {% if wrong_answers %}
            <div class="table-responsive">
              <table class="table table-striped align-middle">
                <thead>
                  <tr>
                    <th scope="col">Question</th>
                    <th scope="col">Domain</th>
                    <th scope="col">Last Attempt</th>
                    <th scope="col">Times Missed</th>
                  </tr>
                </thead>
                <tbody>
                  {% for wrong in wrong_answers %}
                    {% set question = (questions | selectattr('id', 'equalto', wrong.question_id) | list | first) %}
                    <tr>
                      <td>{{ question.question if question else wrong.question_id }}</td>
                      <td>{{ question.domain if question else 'Unknown' }}</td>
                      <td>{{ wrong.last_attempt | default('N/A') }}</td>
                      <td>{{ wrong.wrong_count }}</td>
                    </tr>
                  {% endfor %}
                </tbody>
              </table>
            </div>
          {% else %}
            <p class="text-muted">Great job! No mistakes recorded yet.</p>
          {% endif %}
        </div>
      </div>
    </div>
  </div>
{% endblock %}
